(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{5355:function(e,t,r){Promise.resolve().then(r.bind(r,8716))},8716:function(e,t,r){"use strict";r.d(t,{default:function(){return c}});var s=r(6717),n=r(7387),l=r(8519),a=e=>{let{videoUrl:t,lessonId:r="",lessonName:l="",courseId:a="",courseName:o="",qualityList:c=[],defaultQuality:i,playbackRates:u=[1,1.5,2],defaultPlaybackRate:d=1,userName:m="",companyName:p="",onProgressSave:x,onVideoEnd:f,showWatermark:h=!0,checkInterval:v=300,progressSaveInterval:b=5,autoPlay:g=!1}=e,y=(0,n.useRef)(null),[j,N]=(0,n.useState)(!1),[k,w]=(0,n.useState)(0),[S,P]=(0,n.useState)(0),[T,C]=(0,n.useState)(!1),[E,I]=(0,n.useState)(!1),[_,L]=(0,n.useState)(!1),[R,z]=(0,n.useState)(!1),[M,F]=(0,n.useState)(!1),[U,J]=(0,n.useState)(t),[O,D]=(0,n.useState)(i||c[0]||{label:"720P",value:"720p",url:t}),[V,W]=(0,n.useState)(d),[q,A]=(0,n.useState)(!1),[B,H]=(0,n.useState)(!1),[Q,G]=(0,n.useState)(0),[K,X]=(0,n.useState)(!0),Y=(0,n.useRef)(0),Z=(0,n.useRef)(0),$=(0,n.useRef)(0),ee=(0,n.useRef)(0),et=(0,n.useRef)(0),er=(0,n.useRef)(null),es=(0,n.useCallback)((e,t)=>{let r=[];for(let s=0;s<e;s++)for(let n=0;n<t;n++){let l=-10+120*s/(e-1),a=-15+130*n/(t-1);r.push({top:l,left:a,rotate:-45})}return r},[]),en=es(3,3),el=es(5,6),ea=(0,n.useCallback)((e,t)=>{if(!j||Y.current<=0||Z.current<=0)return!1;let r=(t-Z.current)/1e3;return e-Y.current>r+2&&r>0&&(y.current&&(y.current.currentTime=Y.current),F(!0),setTimeout(()=>{F(!1)},3e3),!0)},[j]),eo=(0,n.useCallback)(e=>{if(j&&!(e<=0)&&!R&&e-$.current>=v){let t=Math.floor(e/v);$.current=t*v,z(!0),y.current&&y.current.pause(),N(!1)}},[j,R,v]),ec=(0,n.useCallback)(e=>{x&&Math.abs(e-ee.current)>=b&&(ee.current=e,x(e))},[x,b]),ei=(0,n.useCallback)(e=>{x&&e>0&&(ee.current=e,x(e))},[x]),eu=(0,n.useCallback)(async()=>{if(r&&!B&&q&&y.current)try{let e=localStorage.getItem("video_progress_".concat(r));if(e){let t=JSON.parse(e).currentTime||0;if(t>0&&y.current){let e=y.current.duration||S,r=e>0?Math.min(t,e-.5):t;if(console.log("Restoring progress:",{savedTime:t,restoreTime:r,duration:e}),y.current.readyState>=2)y.current.currentTime=r,w(r),Y.current=r,ee.current=r,console.log("Progress restored to:",r);else{let e=()=>{var t;y.current&&r>0&&(y.current.currentTime=r,w(r),Y.current=r,ee.current=r,console.log("Progress restored on canplay:",r)),null===(t=y.current)||void 0===t||t.removeEventListener("canplay",e)};y.current.addEventListener("canplay",e)}}}H(!0)}catch(e){console.error("Failed to restore progress:",e),H(!0)}},[r,B,q,S]),ed=(0,n.useCallback)(()=>{if(!B&&q&&r&&y.current){let e=localStorage.getItem("video_progress_".concat(r));if(e)try{let t=JSON.parse(e).currentTime||0,r=y.current.currentTime;if(t>0&&r<1){let e=y.current.duration,r=e>0?Math.min(t,e-.5):t;y.current.currentTime=r,w(r),Y.current=r,ee.current=r,console.log("Progress restored on canplay event:",r),H(!0)}else r>=1&&H(!0)}catch(e){console.error("Failed to restore progress on canplay:",e),H(!0)}else H(!0)}},[B,q,r]);(0,n.useEffect)(()=>{if(g&&q&&B&&y.current&&!j){let e=setTimeout(()=>{if(y.current&&!j){let e=r?localStorage.getItem("video_progress_".concat(r)):null;if(e)try{let t=JSON.parse(e).currentTime||0;t>0&&Math.abs(y.current.currentTime-t)>1&&(y.current.currentTime=t,w(t),Y.current=t,console.log("Re-restoring progress before autoplay:",t))}catch(e){console.error("Failed to re-restore progress:",e)}setTimeout(()=>{y.current&&!j&&y.current.play().catch(e=>{console.warn("Auto-play was prevented:",e)})},200)}},300);return()=>clearTimeout(e)}},[g,q,B,j,r]);let em=()=>{C(!!document.fullscreenElement)};(0,n.useEffect)(()=>(document.addEventListener("fullscreenchange",em),()=>{document.removeEventListener("fullscreenchange",em)}),[]);let ep=e=>{var t;if(e.value===O.value){I(!1);return}eh();let r=(null===(t=y.current)||void 0===t?void 0:t.currentTime)||0;y.current&&y.current.pause(),N(!1),J(e.url),D(e),I(!1),G(r),N(j)},ex=e=>{if(e===V){L(!1);return}eh(),W(e),L(!1),y.current&&(y.current.playbackRate=e)},ef=async()=>{if(y.current){if(T)try{await document.exitFullscreen()}catch(e){console.error("Failed to exit fullscreen:",e)}else try{await y.current.requestFullscreen()}catch(e){console.error("Failed to enter fullscreen:",e)}}},eh=(0,n.useCallback)(()=>{er.current&&clearTimeout(er.current),X(!0),er.current=setTimeout(()=>{X(!1)},3e3)},[]),ev=(0,n.useCallback)(()=>{eh()},[eh]),eb=(0,n.useCallback)(()=>{er.current&&clearTimeout(er.current),er.current=setTimeout(()=>{X(!1)},3e3)},[]);return(0,n.useEffect)(()=>(eh(),()=>{er.current&&clearTimeout(er.current)}),[eh]),(0,n.useEffect)(()=>{let e=()=>{eh()},t=y.current;if(t)return t.addEventListener("click",e),t.addEventListener("mousemove",e),()=>{t.removeEventListener("click",e),t.removeEventListener("mousemove",e)}},[eh]),(0,n.useEffect)(()=>{let e=()=>{I(!1),L(!1)};if(E||_)return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[E,_]),(0,n.useEffect)(()=>{let e=()=>{if(r){var e;let t=Y.current>0?Y.current:(null===(e=y.current)||void 0===e?void 0:e.currentTime)||0;t>0&&ei(t)}},t=e=>{if(r)try{var t;let e=Y.current>0?Y.current:(null===(t=y.current)||void 0===t?void 0:t.currentTime)||0;if(e>0){let t={lessonId:r,currentTime:e,lastSavedTime:Date.now()};localStorage.setItem("video_progress_".concat(r),JSON.stringify(t));try{x&&x(e)}catch(e){}}}catch(e){console.error("Failed to save progress on unload:",e)}},s=()=>{if(document.hidden&&r){var e;let t=Y.current>0?Y.current:(null===(e=y.current)||void 0===e?void 0:e.currentTime)||0;t>0&&ei(t)}};return window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",s),()=>{e(),window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",s)}},[r,ei,x]),(0,s.jsxs)("div",{className:"flex flex-col bg-black ".concat(T?"fixed inset-0 z-50":""),onMouseEnter:ev,onMouseLeave:eb,children:[(0,s.jsxs)("div",{className:"relative w-full bg-black ".concat(T?"h-full":""),style:T?{}:{aspectRatio:"16/9"},children:[(0,s.jsx)("video",{ref:y,src:U,className:"w-full h-full object-contain",onLoadedMetadata:()=>{if(y.current){let e=y.current.duration;if(P(e),A(!0),Q>0){let t=Math.min(Q,e-.5);y.current&&(y.current.currentTime=t,w(t),Y.current=t,G(0),j&&y.current.play());return}B||setTimeout(()=>{eu()},100)}},onCanPlay:ed,onTimeUpdate:()=>{if(!y.current)return;let{currentTime:e,duration:t}=y.current,r=Date.now();if(!j&&et.current>0&&Math.abs(e-et.current)>.5){y.current&&(y.current.currentTime=et.current),w(et.current),Y.current=et.current,F(!0),setTimeout(()=>{F(!1)},3e3);return}if(ea(e,r)){w(Y.current);return}w(e),P(t),Y.current=e,Z.current=r,ec(e),eo(e)},onPlay:()=>{N(!0),Z.current=Date.now(),et.current=0},onPause:()=>{N(!1),Z.current=Date.now(),y.current&&(et.current=y.current.currentTime)},onEnded:()=>{N(!1),r&&localStorage.removeItem("video_progress_".concat(r)),f&&f()},onSeeking:e=>{let t=e.target.currentTime,r=Y.current;t>r+2&&j&&(e.preventDefault(),y.current&&(y.current.currentTime=r),F(!0),setTimeout(()=>{F(!1)},3e3))},controls:!0,playsInline:!0,autoPlay:g}),h&&!T&&(m||p)&&(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none z-10 overflow-hidden",children:en.map((e,t)=>(0,s.jsxs)("div",{className:"absolute text-gray-400 opacity-40 text-sm whitespace-nowrap font-normal",style:{top:"".concat(e.top,"%"),left:"".concat(e.left,"%"),transform:"rotate(".concat(e.rotate,"deg)")},children:[(0,s.jsxs)("div",{children:[m,m&&p?" | ":"",p]}),(0,s.jsx)("div",{className:"mt-1",children:"严禁任何形式录拍 违规必追责"})]},t))}),h&&T&&(m||p)&&(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none z-10 overflow-visible",children:el.map((e,t)=>(0,s.jsxs)("div",{className:"absolute text-gray-400 opacity-40 text-sm whitespace-nowrap font-normal",style:{top:"".concat(e.top,"%"),left:"".concat(e.left,"%"),transform:"rotate(".concat(e.rotate,"deg)")},children:[(0,s.jsxs)("div",{children:[m,m&&p?" | ":"",p]}),(0,s.jsx)("div",{className:"mt-1",children:"严禁任何形式录拍 违规必追责"})]},t))}),!T&&(0,s.jsxs)("div",{className:"absolute bottom-20 left-0 right-0 flex justify-end pr-10 z-20 text-white text-sm transition-opacity duration-300 ".concat(K?"opacity-100":"opacity-0 pointer-events-none"),children:[c.length>0&&(0,s.jsxs)("div",{className:"relative ml-10",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),L(!1),I(!E)},className:"px-4 py-2 bg-black bg-opacity-50 rounded text-white",children:O.label}),E&&(0,s.jsx)("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-black bg-opacity-70 rounded text-white py-2 z-30",onClick:e=>e.stopPropagation(),children:c.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),ep(e)},className:"w-full px-4 py-2 text-left hover:bg-black hover:bg-opacity-50 flex justify-between items-center",children:[(0,s.jsx)("span",{children:e.label}),e.value===O.value&&(0,s.jsx)("span",{children:"✔"})]},e.value))})]}),(0,s.jsxs)("div",{className:"relative ml-4",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),I(!1),L(!_)},className:"px-4 py-2 bg-black bg-opacity-50 rounded text-white",children:1===V?"正常":"".concat(V,"倍")}),_&&(0,s.jsx)("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-black bg-opacity-70 rounded text-white py-2 z-30",onClick:e=>e.stopPropagation(),children:u.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),ex(e)},className:"w-full px-4 py-2 text-left hover:bg-black hover:bg-opacity-50 flex justify-between items-center",children:[(0,s.jsx)("span",{children:1===e?"正常":"".concat(e,"倍")}),e===V&&(0,s.jsx)("span",{children:"✔"})]},e))})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),ef()},className:"ml-4 px-4 py-2 bg-black bg-opacity-50 rounded text-white",children:"全屏"})]}),T&&(0,s.jsxs)("div",{className:"absolute bottom-20 left-0 right-0 flex justify-end pr-10 z-20 text-white text-sm pointer-events-none transition-opacity duration-300 ".concat(K?"opacity-100":"opacity-0"),children:[c.length>0&&(0,s.jsxs)("div",{className:"relative ml-10 pointer-events-auto",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),L(!1),I(!E)},className:"px-4 py-2 bg-black bg-opacity-50 rounded text-white",children:O.label}),E&&(0,s.jsx)("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-black bg-opacity-70 rounded text-white py-2 z-30",onClick:e=>e.stopPropagation(),children:c.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),ep(e)},className:"w-full px-4 py-2 text-left hover:bg-black hover:bg-opacity-50 flex justify-between items-center",children:[(0,s.jsx)("span",{children:e.label}),e.value===O.value&&(0,s.jsx)("span",{children:"✔"})]},e.value))})]}),(0,s.jsxs)("div",{className:"relative ml-4 pointer-events-auto",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),I(!1),L(!_)},className:"px-4 py-2 bg-black bg-opacity-50 rounded text-white",children:1===V?"正常":"".concat(V,"倍")}),_&&(0,s.jsx)("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-black bg-opacity-70 rounded text-white py-2 z-30",onClick:e=>e.stopPropagation(),children:u.map(e=>(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),ex(e)},className:"w-full px-4 py-2 text-left hover:bg-black hover:bg-opacity-50 flex justify-between items-center",children:[(0,s.jsx)("span",{children:1===e?"正常":"".concat(e,"倍")}),e===V&&(0,s.jsx)("span",{children:"✔"})]},e))})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eh(),ef()},className:"ml-4 px-4 py-2 bg-black bg-opacity-50 rounded text-white pointer-events-auto",children:"退出全屏"})]})]}),!T&&l&&(0,s.jsx)("div",{className:"p-6 bg-white border-b border-gray-200",children:(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:l})}),M&&(0,s.jsx)("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in",children:(0,s.jsxs)("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsx)("span",{className:"font-medium",children:"不允许快进，请按正常速度观看"})]})}),R&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-8 w-80 shadow-xl",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-800 text-center mb-4",children:"提示"}),(0,s.jsx)("p",{className:"text-gray-600 text-center mb-6",children:"您已观看5分钟，是否继续学习？"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>{z(!1),y.current&&y.current.pause(),N(!1)},className:"flex-1 py-3 bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors",children:"取消"}),(0,s.jsx)("button",{onClick:()=>{z(!1),setTimeout(()=>{y.current&&y.current.play(),N(!0)},300)},className:"flex-1 py-3 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"确定"})]})]})})]})},o=r(9958);function c(e){let{lessonId:t,courseId:r}=e,c=(0,l.useRouter)(),[i,u]=(0,n.useState)(null),[d,m]=(0,n.useState)([]),[p,x]=(0,n.useState)(void 0),[f,h]=(0,n.useState)(0),[v,b]=(0,n.useState)(0),[g,y]=(0,n.useState)(0),[j,N]=(0,n.useState)(o.ze[0]||null);return((0,n.useEffect)(()=>{let e=j;if(r){let t=o.ze.find(e=>e.courseId===r);t&&(e=t,N(t))}if(e||N(e=o.ze[0]),e&&e.lessons.length>0){let r;if(t&&(r=e.lessons.find(e=>e.lessonId===t)),r||(r=e.lessons[0]),r){u(r);let t=(0,o.Jz)(r.videoVariants);m(t),x(t.find(e=>"720p"===e.value)||t[0]);let s=e.lessons.length,n=e.lessons.filter(e=>"completed"===e.status).length;h(s),b(n),y(Math.round(n/s*100))}}},[t,r]),i)?(0,s.jsxs)("div",{className:"bg-gray-50 min-h-screen",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm sticky top-0 z-40",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-3",children:(0,s.jsxs)("button",{onClick:()=>{c.push("/")},className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,s.jsx)("span",{children:"返回课程列表"})]})})}),(0,s.jsx)(a,{videoUrl:(null==p?void 0:p.url)||i.videoUrl,lessonId:i.lessonId,lessonName:i.lessonName,courseId:(null==j?void 0:j.courseId)||"",courseName:(null==j?void 0:j.courseName)||"",qualityList:d,defaultQuality:p,playbackRates:[1,1.5,2],defaultPlaybackRate:1,userName:o._P.userName,companyName:o._P.companyName,onProgressSave:e=>{if(!i||!j)return;localStorage.setItem("video_progress_".concat(i.lessonId),JSON.stringify({lessonId:i.lessonId,currentTime:e,lastSavedTime:Date.now()}));let t=j.lessons.find(e=>e.lessonId===i.lessonId);t&&(t.videoProgress=e)},onVideoEnd:()=>{if(!i||!j)return;let e=j.lessons.find(e=>e.lessonId===i.lessonId);if(e){e.status="completed",e.videoProgress=0;let t=j.lessons.length,r=j.lessons.filter(e=>"completed"===e.status).length;h(t),b(r),y(Math.round(r/t*100)),u({...e})}localStorage.removeItem("video_progress_".concat(i.lessonId))},showWatermark:!0,autoPlay:!0}),j&&(0,s.jsx)("div",{className:"bg-white p-6",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,s.jsxs)("div",{className:"flex justify-around items-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 mb-2",children:"学习进度"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-blue-500",children:[g,"%"]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 mb-2",children:"总课时"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-blue-500",children:f})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500 mb-2",children:"已学课时"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-blue-500",children:v})]})]})})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-gray-500",children:"加载中..."})})}},9958:function(e,t,r){"use strict";r.d(t,{Jz:function(){return c},_P:function(){return o},ze:function(){return a}});let s="https://media.w3.org/2010/05/sintel/trailer_hd.mp4",n="https://media.w3.org/2010/05/sintel/trailer.mp4",l="https://media.w3.org/2010/05/bunny/movie.mp4",a=[{courseId:"1",courseName:"React开发实战课程",lessons:[{id:"1",lessonId:"1",lessonName:"React基础入门",videoUrl:s,videoVariants:[{resolution:"480p",url:n},{resolution:"720p",url:s},{resolution:"1080p",url:s}],status:"uncompleted",videoProgress:0},{id:"2",lessonId:"2",lessonName:"React Hooks深入理解",videoUrl:n,videoVariants:[{resolution:"480p",url:n},{resolution:"720p",url:s}],status:"uncompleted",videoProgress:0},{id:"3",lessonId:"3",lessonName:"React性能优化",videoUrl:l,videoVariants:[{resolution:"720p",url:l},{resolution:"1080p",url:s}],status:"completed",videoProgress:0}]}],o={userName:"张三",companyName:"示例科技有限公司"},c=e=>{if(!e||0===e.length)return[];let t={"480p":1,"720p":2,"1080p":3,source:4};return e.map(e=>{let t=e.resolution||"source";return{label:"480p"===t?"480P":"720p"===t?"720P":"1080p"===t?"1080P":"source"===t?"原版（高清）":t.charAt(0).toUpperCase()+t.slice(1),value:t,url:e.url}}).sort((e,r)=>(t[e.value]||99)-(t[r.value]||99))}},8519:function(e,t,r){"use strict";var s=r(5878);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[407,809,744],function(){return e(e.s=5355)}),_N_E=e.O()}]);